version: '3'
services:
    eureka-service:
        container_name: eureka-service
        image: bookstore/eureka_service:latest
        # build:
        #     context: Eureka-server
        #     dockerfile: Dockerfile
        ports:
            - "8761:8761"
        restart: always
        networks:
            - eureka-network

    main-service:
        container_name: main-service
        image: bookstore/gateway_service:latest
        # build:
        #     context: Service-master
        #     dockerfile: Dockerfile
        ports:
            - "9090:9090"
        depends_on:
            - accounts-service
            - products-service
            - baskets-service
            - orders-service
            - eureka-service
        environment:
            EUREKA_ADDR: eureka-service
        networks:
            - eureka-network

    accounts-service:
        container_name: accounts-service
        image: bookstore/accounts_service:latest
        # build:
        #     context: Accounts-master
        #     dockerfile: Dockerfile
        ports:
            - "8081:8081"
        restart: always
        depends_on:
            - mysql-accounts
            - eureka-service
        environment:
            RDS_HOSTNAME: mysql-accounts
            RDS_PORT: 3306
            RDS_DB_NAME: db_accounts
            RDS_USERNAME: springuser
            RDS_PASSWORD: Password
            EUREKA_ADDR: eureka-service

        networks:
            - accounts-service-network
            - eureka-network

    products-service:
        container_name: products-service
        image: bookstore/products_service:latest
        # build:
        #     context: Products-master
        #     dockerfile: Dockerfile
        ports:
            - "8084:8084"
        restart: always
        depends_on:
            - mysql-products
            - eureka-service
        environment:
            RDS_HOSTNAME: mysql-products
            RDS_PORT: 3306
            RDS_DB_NAME: db_products
            RDS_USERNAME: springuser
            RDS_PASSWORD: Password
            EUREKA_ADDR: eureka-service

        networks:
            - products-service-network
            - eureka-network

    baskets-service:
        container_name: baskets-service
        image: bookstore/baskets_service:latest
        # build:
        #     context: Baskets-master
        #     dockerfile: Dockerfile
        ports:
            - "8082:8082"
        restart: always
        depends_on:
            - mysql-baskets
        environment:
            RDS_HOSTNAME: mysql-baskets
            RDS_PORT: 3306
            RDS_DB_NAME: db_baskets
            RDS_USERNAME: springuser
            RDS_PASSWORD: Password
            EUREKA_ADDR: eureka-service

        networks:
            - baskets-service-network
            - eureka-network

    orders-service:
        container_name: orders-service
        image: bookstore/orders_service:latest
        # build:
        #     context: Orders-master
        #     dockerfile: Dockerfile
        ports:
            - "8083:8083"
        restart: always
        depends_on:
            - mysql-orders
        environment:
            RDS_HOSTNAME: mysql-orders
            RDS_PORT: 3306
            RDS_DB_NAME: db_orders
            RDS_USERNAME: springuser
            RDS_PASSWORD: Password
            EUREKA_ADDR: eureka-service

        networks:
            - orders-service-network
            - eureka-network

    mysql-accounts:
        image: mysql:5.7
        environment:
            MYSQL_ROOT_PASSWORD: Password
            MYSQL_USER: springuser
            MYSQL_PASSWORD: Password
            MYSQL_DATABASE: db_accounts

        container_name: mysql-accounts
        restart: always
        ports:
            - "3307:3306"
        volumes:
            - mysql-dbaccounts-volume:/var/lib/mysql
        networks:
            - accounts-service-network

    mysql-products:
        image: mysql:5.7
        environment:
            MYSQL_ROOT_PASSWORD: Password
            MYSQL_USER: springuser
            MYSQL_PASSWORD: Password
            MYSQL_DATABASE: db_products
        container_name: mysql-products
        restart: always
        ports:
            - "3308:3306"
        volumes:
            - mysql-dbproducts-volume:/var/lib/mysql
        networks:
            - products-service-network

    mysql-baskets:
        image: mysql:5.7
        environment:
            MYSQL_ROOT_PASSWORD: Password
            MYSQL_USER: springuser
            MYSQL_PASSWORD: Password
            MYSQL_DATABASE: db_baskets
        container_name: 'mysql-baskets'
        restart: always
        ports:
            - "3309:3306"
        volumes:
            - mysql-dbbaskets-volume:/var/lib/mysql
        networks:
            - baskets-service-network

    mysql-orders:
        image: mysql:5.7
        environment:
            MYSQL_ROOT_PASSWORD: Password
            MYSQL_USER: springuser
            MYSQL_PASSWORD: Password
            MYSQL_DATABASE: db_orders
        container_name: 'mysql-orders'
        restart: always
        ports:
            - 3310:3306
        volumes:
            - mysql-dborders-volume:/var/lib/mysql
        networks:
            - orders-service-network

volumes:
    mysql-dbaccounts-volume:
    mysql-dbproducts-volume:
    mysql-dbbaskets-volume:
    mysql-dborders-volume:

networks:
    accounts-service-network:
    products-service-network:
    baskets-service-network:
    orders-service-network:
    eureka-network:
